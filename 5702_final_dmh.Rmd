---
title: "5702_final_dmh"
output: html_document
---
```{r}
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
library(lubridate)
```

```{r}
state_case = read.csv("us-states.csv")
restaurant = read.csv("YoY_Seated_Diner_Data-2.csv")
restaurant1 = restaurant %>% pivot_longer(cols = starts_with("X"),
                           names_to = "Date",
                           values_to = "Percentage")%>%
               mutate(Date = paste0("2020.",str_remove(Date,"X")))%>%
               mutate(Date = as.Date(chartr(old = ".", new = "-", Date)))
```
Firstly we want to see the US national trend of restaurant reservation compared to the same time last year.

```{r}
head(restaurant1)
```
```{r}
US.nation.res = restaurant1[which(restaurant1$Type=="country" & restaurant1$Name=="United States"), ]

ggplot(US.nation.res) +
  geom_line(aes(x=Date, y=Percentage),color="#69b3a2") + 
  geom_hline(yintercept=0, color="orange", size=.5)+ 
  theme(axis.text.x=element_text(angle=60, hjust=1))+
  theme_light()+
  ggtitle("Year-over-year Comparison of seated dinner in the US")
```
```{r}
US_case = read.csv("us-states.csv")
US_case_by_date = US_case %>%
  mutate(date = as.Date(date))%>%
  group_by(date) %>%
  summarize(cumu_sum = sum(cases)) %>%
  mutate(daily_new = cumu_sum-lag(cumu_sum)) %>%
  drop_na()
US_case_by_date
```
```{r}
ggplot() +
  geom_line(data = US.nation.res,aes(x=Date, y=Percentage),color="#69b3a2") + 
  geom_hline(yintercept=0, color="orange", size=.5)+ 
  theme(axis.text.x=element_text(angle=60, hjust=1))+
  theme_light()+
  ggtitle("Year-over-year Comparison of seated dinner in the US")
```

```{r}
library("viridis")      
ggplot(restaurant_state, aes(x = Date, y = Name, fill = Percentage)) + 
  geom_tile()+
  scale_fill_viridis()
  
```

The heatmap above shows the number of seated diners by state from February until December 2020. We can see a clear drop in seated dinners across all states since mid-March.
Hawaii's restaurant industry was hit hardest and just had a slight recovery after November. District of Columbia also has a visibly severe impact on sitted dinner than other states. People in New York, New Jersey and Washinton seem to go for sitted dinner later. On the contrary,Alabama, Arizona, Florida, Oklahoma and Texas start eating out earlier. 

```{r}
ggplot() +
  geom_line(data = US_case_by_date,aes(x=date, y=daily_new),color="orange") + 
  theme(axis.text.x=element_text(angle=60, hjust=1))+
  theme_light()+
  ggtitle("Daily COVID case in US")
```


### data preprocessing
```{r}
us_states = c('Alabama','Arizona','California','Colorado', 'Connecticut',
       'District of Columbia', 'Florida', 'Georgia', 'Hawaii', 'Illinois',
       'Indiana', 'Kansas', 'Kentucky', 'Louisiana',
       'Maryland', 'Massachusetts', 'Michigan',
       'Minnesota', 'Missouri', 'Nebraska', 'Nevada', 'New Jersey',
       'New Mexico', 'New York', 'North Carolina', 'Ohio', 'Oklahoma', 'Oregon',
       'Pennsylvania','Rhode Island', 'South Carolina', 'Tennessee', 
       'Texas', 'Utah', 'Virginia', 'Washington', 'Wisconsin')
```

```{r}
restaurant_state = restaurant1[restaurant1$Type == 'state',]
restaurant_state = restaurant_state[restaurant_state$Name %in% us_states,]
```
The original YoY_Seated_Diner_Data-2.csv file contains information about 8 country of 60 state and 60 cities. Here we only extract US state information 
